<div class="task-page">

  <mat-drawer-container class="drawer-container">

    <!-- LEFT SIDE -->
    <mat-drawer-content>

      <div class="top-actions">
        <mat-form-field appearance="outline">
          <mat-label>Filter by Employee</mat-label>
          <mat-select (selectionChange)="filterByEmployee($event.value)">
            <mat-option value="">All</mat-option>
            <mat-option *ngFor="let emp of employees" [value]="emp.id">
              {{ emp.fullName }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <button mat-raised-button color="primary" (click)="openAdd()">
          Add Task
        </button>
      </div>

      <!-- TABLE -->
      <table mat-table [dataSource]="filteredTasks" class="mat-elevation-z8">

        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef>Title</th>
          <td mat-cell *matCellDef="let t">{{ t.title }}</td>
        </ng-container>

        <ng-container matColumnDef="assigned">
          <th mat-header-cell *matHeaderCellDef>Assigned To</th>
          <td mat-cell *matCellDef="let t">{{ t.assignedTo?.fullName }}</td>
        </ng-container>

        <ng-container matColumnDef="priority">
          <th mat-header-cell *matHeaderCellDef>Priority</th>
          <td mat-cell *matCellDef="let t">
            <mat-chip color="primary">{{ t.priority }}</mat-chip>
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let t">
            <button mat-icon-button color="primary" (click)="onEdit(t)">
              <mat-icon>edit</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="['title','assigned','priority','actions']"></tr>
        <tr mat-row *matRowDef="let row; columns: ['title','assigned','priority','actions']"></tr>
      </table>

    </mat-drawer-content>

    <!-- RIGHT SIDE DRAWER -->
    <mat-drawer #drawer position="end" mode="over" class="drawer-panel">

      <h2>{{ isEdit ? 'Edit Task' : 'Add Task' }}</h2>

      <mat-form-field appearance="fill">
        <mat-label>Title</mat-label>
        <input matInput [(ngModel)]="form.title">
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Description</mat-label>
        <textarea matInput rows="3" [(ngModel)]="form.description"></textarea>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Assign To</mat-label>
        <mat-select [(ngModel)]="form.assignedToId">
          <mat-option *ngFor="let emp of employees" [value]="emp.id">
            {{ emp.fullName }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Priority</mat-label>
        <mat-select [(ngModel)]="form.priority">
          <mat-option value="Low">Low</mat-option>
          <mat-option value="Medium">Medium</mat-option>
          <mat-option value="High">High</mat-option>
        </mat-select>
      </mat-form-field>

      <div class="drawer-actions">
        <button mat-raised-button color="primary" (click)="saveTask()">Save</button>
        <button mat-button (click)="drawer.close()">Cancel</button>
      </div>

    </mat-drawer>

  </mat-drawer-container>

</div>
